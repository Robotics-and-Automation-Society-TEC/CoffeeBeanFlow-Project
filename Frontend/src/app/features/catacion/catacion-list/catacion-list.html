<div class="list-container">
  <a routerLink="/" class="btn-home">
    üè† Volver a Inicio
  </a>
  
  <div class="header">
    <h2>Gesti√≥n de Cataci√≥n</h2>
    <button class="btn-primary" (click)="nuevoRegistro()">+ Nueva Cataci√≥n</button>
  </div>

  <div *ngIf="cargando" class="loading">Cargando registros...</div>

  <div *ngIf="!cargando && cataciones.length === 0" class="empty-state">
    <p>No hay registros de cataci√≥n a√∫n</p>
    <button class="btn-primary" (click)="nuevoRegistro()">Crear el primero</button>
  </div>

  <div *ngIf="!cargando && cataciones.length > 0" class="cards-grid">
    <div class="catacion-card" *ngFor="let catacion of cataciones">
      <div class="card-header">
        <span class="id-text">LOTE: {{ catacion.nlote || 'Sin lote' }}</span>
        <span class="estado-text">{{ getEstadoCalidad(catacion.pfinales) }} {{ catacion.pfinales }}</span>
      </div>

      <div class="card-body">
        <!-- Informaci√≥n General -->
        <div class="info-section">
          <h3 class="section-title">üìã Informaci√≥n General</h3>
          <table class="info-table">
            <tr class="highlight-row">
              <td class="label-cell">Puntos Finales:</td>
              <td class="value-cell primary-value">{{ catacion.pfinales || '-' }}</td>
            </tr>
            <tr>
              <td class="label-cell">Limpio:</td>
              <td class="value-cell">{{ catacion.limpio ? (catacion.limpio + '%') : '-' }}</td>
            </tr>
            <tr>
              <td class="label-cell">Defectuoso:</td>
              <td class="value-cell">{{ catacion.defectuoso ? (catacion.defectuoso + '%') : '-' }}</td>
            </tr>
            <tr>
              <td class="label-cell">CC Calidad:</td>
              <td class="value-cell">{{ catacion.cccalidad ? (catacion.cccalidad + '%') : '-' }}</td>
            </tr>
          </table>
        </div>

        <!-- Calidad y Tostado -->
        <div class="info-section">
          <h3 class="section-title">üî• Calidad y Tostado</h3>
          <table class="info-table">
            <tr>
              <td class="label-cell">FF Reposo:</td>
              <td class="value-cell">{{ catacion.ffreposo || '-' }}</td>
            </tr>
            <tr>
              <td class="label-cell">Quaker:</td>
              <td class="value-cell">{{ catacion.quaker || '-' }}</td>
            </tr>
            <tr>
              <td class="label-cell">CC Verde:</td>
              <td class="value-cell">{{ catacion.ccverde ? (catacion.ccverde + '%') : '-' }}</td>
            </tr>
            <tr>
              <td class="label-cell">R Tostado:</td>
              <td class="value-cell">{{ catacion.rtostado ? (catacion.rtostado + '%') : '-' }}</td>
            </tr>
          </table>
        </div>

        <!-- Defectos -->
        <div class="info-section defects-section">
          <h3 class="section-title">‚ö†Ô∏è Defectos</h3>
          <div class="defects-summary">
            <div class="defect-card">
              <span class="defect-label">Categor√≠a 1</span>
              <span class="defect-value c1">{{ contarDefectosCategoria1(catacion) }}</span>
            </div>
            <div class="defect-card">
              <span class="defect-label">Categor√≠a 2</span>
              <span class="defect-value c2">{{ contarDefectosCategoria2(catacion) }}</span>
            </div>
          </div>
        </div>

        <!-- Zaranda -->
        <div class="info-section" *ngIf="catacion.veinte || catacion.dieciocho || catacion.dieciseis">
          <h3 class="section-title">üìè Zaranda - Principales Tamices</h3>
          <table class="info-table">
            <tr *ngIf="catacion.veinte">
              <td class="label-cell">Tamiz 20:</td>
              <td class="value-cell">{{ catacion.veinte + '%' }}</td>
            </tr>
            <tr *ngIf="catacion.diecinueve">
              <td class="label-cell">Tamiz 19:</td>
              <td class="value-cell">{{ catacion.diecinueve + '%' }}</td>
            </tr>
            <tr *ngIf="catacion.dieciocho">
              <td class="label-cell">Tamiz 18:</td>
              <td class="value-cell">{{ catacion.dieciocho + '%' }}</td>
            </tr>
            <tr *ngIf="catacion.diecisiete">
              <td class="label-cell">Tamiz 17:</td>
              <td class="value-cell">{{ catacion.diecisiete + '%' }}</td>
            </tr>
            <tr *ngIf="catacion.dieciseis">
              <td class="label-cell">Tamiz 16:</td>
              <td class="value-cell">{{ catacion.dieciseis + '%' }}</td>
            </tr>
          </table>
        </div>

        <!-- Rondas de Evaluaci√≥n -->
        <div class="info-section rondas-section" *ngIf="catacion.rondas && catacion.rondas.length > 0">
          <div class="rondas-header">
            <h3 class="section-title">üéØ Rondas de Evaluaci√≥n</h3>
            <span class="rondas-badge">{{ catacion.rondas.length }} ronda(s)</span>
          </div>
          <div class="rondas-list">
            <div class="ronda-item" *ngFor="let ronda of catacion.rondas; let i = index">
              <span class="ronda-label">Ronda {{ i + 1 }}:</span>
              <span class="ronda-score">{{ ronda.valorCalidad || '-' }}</span>
            </div>
          </div>
          <div class="promedio-rondas" *ngIf="calcularPromedioRondas(catacion)">
            <span class="promedio-label">Promedio:</span>
            <span class="promedio-value">{{ calcularPromedioRondas(catacion) }}</span>
          </div>
        </div>
      </div>

      <div class="card-footer">
        <button class="btn-edit" (click)="editarRegistro(catacion.idCatacion)">‚úèÔ∏è Editar</button>
        <button class="btn-delete" (click)="eliminarRegistro(catacion.idCatacion)">üóëÔ∏è Eliminar</button>
      </div>
    </div>
  </div>
</div>
